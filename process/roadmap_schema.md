# Roadmap Schema Specification

**Purpose:** Define the normalized roadmap format that works across any `.agent_process` project.

**See also:** `naming_conventions.md` for requirement ID formats and file naming rules.

---

## File Structure

```
.agent_process/roadmap/
‚îú‚îÄ‚îÄ master_roadmap.md           # Consolidated roadmap (all status, categories, requirements)
‚îú‚îÄ‚îÄ backlog.md                  # Prioritized work queue (future items)
‚îú‚îÄ‚îÄ .roadmap_config.json        # User configuration and project mappings
‚îú‚îÄ‚îÄ archived_roadmap.md         # (created on first archive) Archived requirements
‚îî‚îÄ‚îÄ .roadmap_audit.jsonl        # (created on first status change) Audit trail
```

**Note:** Previous versions used separate `work_scope_details.md`, `phase_status.md`, and `.discovery_meta.json` files. These have been consolidated into `master_roadmap.md` to reduce navigation complexity.

---

## Master Roadmap Format (Consolidated)

**File:** `master_roadmap.md`

This is the single source of truth for project status. It contains all information previously spread across multiple files.

```markdown
# Project Roadmap

> **Last Updated:** [TIMESTAMP]
> **Discovery Source:** [Detected structure pattern]
> **Requirements with Work:** [N] | **Complete:** [N] | **In Progress:** [N] | **Blocked:** [N]

## Status Summary

**Overall Completion: [%]** ([N]/[M] requirements with active work)

| Status | Count | Percentage |
|--------|-------|------------|
| ‚úÖ Complete | [N] | [%] |
| üöß In Progress | [N] | [%] |
| ‚ùå Blocked | [N] | [%] |
| üìã Not Started | [N] | [%] |

## Category Breakdown

| Category | Complete | In Progress | Blocked | Completion |
|----------|----------|-------------|---------|------------|
| [Category Name] | [N] | [N] | [N] | [%] |

## Active Work (In Progress)

| Requirement | Category | Work Scopes |
|-------------|----------|-------------|
| [requirement_id] | [category] | [N] |

## Blocked Items

| Requirement | Category | Work Scopes | Notes |
|-------------|----------|-------------|-------|
| [requirement_id] | [category] | [N] | [brief reason] |

## Matching Statistics

- **Total work directories:** [N]
- **Direct matches (frontmatter IDs):** [N] ([%])
- **Project mapping matches:** [N] ([%])
- **Fuzzy matches:** [N] ([%])
- **Orphaned work:** [N] ([%])

## Requirements by Category

### [Category Name] ([%] complete)

| Status | Priority | Requirement | Work Scopes |
|--------|----------|-------------|-------------|
| [icon] | [PRIORITY] | [Display Name] | [N] |

---

*Generated by `/ap_project sync` on [TIMESTAMP]*
```

**Field Definitions:**
- **Status icons**: ‚úÖ Complete | üöß In Progress | ‚ùå Blocked | üìã Not Started
- **Priority**: CRITICAL | HIGH | MEDIUM | LOW
- **Work Scopes**: Count of work directories matched to this requirement
- **Matching Statistics**: Shows how work directories were matched (direct = frontmatter ID match, project_mapping = manual override, fuzzy = algorithmic fallback)

---

## Backlog Format

**File:** `backlog.md`

```markdown
# Project Backlog

> Items not yet formal requirements. Migrated from existing todo files and discovered follow-up work.

## CRITICAL Priority

- [ ] **[Item summary]** - Source: [origin] - Type: [Bug Fix|Feature|Enhancement|Tech Debt]
  *[Brief description]*
  *Needs Scope: [YES|NO]*

## HIGH Priority

- [ ] **[Item summary]** - Source: [origin] - Type: [Type]
  *[Description]*
  *Needs Scope: [YES|NO]*

## MEDIUM Priority

- [ ] **[Item summary]** - Source: [origin] - Type: [Type]
  *[Description]*

## LOW Priority

- [ ] **[Item summary]** - Source: [origin] - Type: [Type]
  *[Description]*

---

## Completed/Resolved

See existing resolved todo file (if present) or note completions inline.
```

---

## Roadmap Configuration

**File:** `.roadmap_config.json`

```json
{
  "include_patterns": ["**/*.md"],
  "exclude_patterns": [
    "**/bugs/**",
    "**/_TEMPLATE_*",
    "**/artifacts/**"
  ],
  "index_file_patterns": [
    "**/README.md",
    "**/*_index.md",
    "**/*_overview.md",
    "**/*_roadmap.md"
  ],
  "priority_mapping": {
    "comment": "Canonical values: CRITICAL, HIGH, MEDIUM, LOW. Legacy mappings normalize variants.",
    "CRITICAL": "CRITICAL",
    "HIGH": "HIGH",
    "MEDIUM": "MEDIUM",
    "LOW": "LOW",
    "P0": "CRITICAL",
    "P1": "HIGH",
    "P2": "MEDIUM",
    "High": "HIGH",
    "Medium": "MEDIUM",
    "Low": "LOW",
    "high": "HIGH",
    "medium": "MEDIUM",
    "low": "LOW"
  },
  "categories": {
    "auto_detect": true,
    "prefix_mappings": {
      "_comment": "Map requirement ID prefixes to categories",
      "lexical_epic_": "lexical_editor"
    }
  },
  "status_markers": {
    "complete": ["‚úÖ COMPLETE", "**Status:** COMPLETE"],
    "blocked": ["BLOCKED"],
    "in_progress": ["IN PROGRESS", "WIP"],
    "failed": ["**Status:** ‚ùå FAILED"]
  },
  "project_mappings": {
    "work_to_requirement": {
      "_comment": "Maps work directory names to requirement IDs",
      "work_dir_name": "requirement_id"
    }
  },
  "status_overrides": {
    "_comment": "Runtime overrides from /ap_project set-status command",
    "requirement_id": {
      "status": "complete",
      "reason": "Manual override",
      "set_at": "2026-01-17T22:30:00Z"
    }
  }
}
```

**Configuration Notes:**
- `exclude_patterns`: Add project-specific patterns as needed
- `index_file_patterns`: Files matching these are used for metadata, not counted as requirements
- `categories.prefix_mappings`: Map requirement ID prefixes to category names (checked before directory-based detection)
- `status_markers`: Object with arrays for `complete`, `blocked`, `in_progress`, and `failed` patterns to detect in results.md
- `project_mappings.work_to_requirement`: Maps work directory names to requirement IDs. Essential for hierarchical structures where fuzzy matching fails (e.g., `"ai_radar_scope_18": "ai_radar_based_feedback_system_implementation_01_ambient_layer_18_requirements"`)
- `status_overrides`: Runtime overrides from `/ap_project set-status` command. These always win over discovered status.

---

## Schema Validation

All roadmap files should:
- **Be human readable** markdown (except JSON config)
- **Include timestamps** for change tracking
- **Show completion percentages** for quick status assessment
- **Link related items** (requirements ‚Üî work scopes)
- **Handle missing data gracefully** (TBD, unknown status, `0/?`)
- **Support incremental updates** (don't regenerate everything on small changes)

---

## Migration Notes

**Replacing Sub-Roadmaps:**

If the project has existing sub-roadmap files (README.md files that list scopes, category-specific roadmaps):

1. The master roadmap becomes the **single source of truth** for status
2. Sub-roadmap files can be kept as **documentation** but should not duplicate status tracking
3. The discovery process extracts metadata from sub-roadmaps (phases, dependencies, timelines)
4. Consider marking old sub-roadmap files with a note: "Status tracking moved to master roadmap"

**Preserving History:**

When initializing a roadmap on an existing project:
- Scan all work directories to determine historical completion
- Use results.md timestamps for "Last Activity" dates
- Flag discrepancies between sub-roadmaps and discovered state

---

This schema works across any `.agent_process` project regardless of organizational structure or naming conventions.